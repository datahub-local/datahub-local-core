# https://github.com/cloudnative-pg/charts/blob/main/charts/cluster/values.yaml

type: postgresql
mode: standalone

cluster:
  instances: 1

  resources:
    limits:
      cpu: "1"
      memory: 4Gi
    requests:
      cpu: "1"
      memory: 4Gi

  storage:
    size: 8Gi
    storageClass: "longhorn"

  walStorage:
    enabled: true
    size: 3Gi
    storageClass: "longhorn"

  enableSuperuserAccess: true
  superuserSecret: "postgresql-admin-credentials"

  monitoring:
    enabled: true
    prometheusRule:
      excludeRules:
        - CNPGClusterHACritical
        - CNPGClusterHAWarning

poolers:
  - name: rw
    type: rw
    poolMode: transaction
    instances: 2
    parameters:
      max_client_conn: "1000"
      default_pool_size: "25"
    monitoring:
      enabled: true
      podMonitor:
        enabled: true

backups:
  enabled: true

  endpointURL: "https://{{ .Values.backup_s3_endpoint }}"
  provider: s3
  s3:
    bucket: "{{ $.Values.backup_s3_bucket }}"
    path: "/postgresql-cn/"
  secret:
    create: false
    name: backup-cloudnative-pg-auth

  wal:
    encryption:
  data:
    encryption:

  scheduledBackups:
    - name: daily-backup # Daily at midnight
      schedule: "0 0 0 * * *" # Daily at midnight
      backupOwnerReference: self
      method: barmanObjectStore
  retentionPolicy: "30d"
